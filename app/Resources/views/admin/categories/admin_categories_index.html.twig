{% extends 'base.html.twig' %}

{% block header %}
    {# ----------------- Menu dashboard ----------------- #}
    {% include 'includes/menu_admin_dashboard.html.twig' %}
    <h5 class="title-page mb-4">Administration des catégories</h5>
{% endblock %}

{% block content %}
<main id="dashboard">
    {% include 'includes/flash_load_ajax.html.twig' %}

    {# ----------------- Modal Suppression categories ----------------- #}
    <div id="validate-modal" class="d-none" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="message-delete">
            <div>Etes vous sûr de vouloir supprimer la catégorie <b><span class="name"></span></b> ?</div>
            <div>
                <button id="validate" class="btn btn-danger btn-sm">Valider</button>
                <button id="cancel" class="btn btn-info btn-sm">Annuler</button>
            </div>
        </div>
    </div>

    <div class="container">
        {# ----------------- Ajouter une Categories ----------------- #}
        <form action="{{ path('admin_categories') }}" method="POST">
            <div class="form-catg mb-4">
                <input type="text" name="name" id="appbundle_category_name" required>
                <button type="submit" name="submit" value="true" class="submit btn btn-warning ml-3">Ajouter</button>
            </div>
        </form>

        {# ----------------- Categories ----------------- #}
        <div class="categories">
            {% for category in categories %}
                <div class="catg-box">
                    <div class="name-catg">{{ category.name }}</div>

                    <div class="btn-catg">
                        {# Editer une categorie #}
                        <a href="" class="edit btn btn-info btn-sm"
                           data-id-catg="{{ category.id }}" data-name-catg="{{ category.name }}">
                            <i class="far fa-edit"></i>
                        </a>
                        {# Supprimer une categorie #}
                        <a href="" class="delete btn btn-danger btn-sm"
                           data-delete-id="{{ category.id }}" data-delete-name="{{ category.name }}"
                           data-delete-path="{{ path('admin_ajax_categories_delete') }}">
                            <i class="fas fa-trash-alt"></i>
                        </a>
                    </div>
                </div>
            {% else %}
                <div class="no-infos">
                    <span>Aucune catégorie trouvée.</span>
                </div>
            {% endfor %}
        </div>
    </div>
</main>
{% endblock %}


{#<a href="{{ path('admin_categories', {id: category.id}) }}" class="edit btn btn-info btn-sm">
    <i class="far fa-edit"></i>
</a>#}

{% block scripts %}
    {% include 'includes/js_ajax_delete.html.twig' %}
    <script>
        $(document).ready(function () {

            $('.edit').on('click', function (e) {
                e.preventDefault()

                var id = $(this).data('id-catg')
                var name = $(this).data('name-catg')
                var hidden = $('.hidden-id').val()

                $('#appbundle_category_name').val(name)
                $('.submit').text('Modifier')

                if(hidden)
                {
                    $('.hidden-id').val(id)
                    console.log('if')

                } else {

                    $('.form-catg').append("<input hidden name='id' class='hidden-id' type='number' value='"+ id +"'/>")
                    console.log('else')
                }
            })

            $('#appbundle_category_name').on('input', function () {

                var isEmpty = $(this).val()

                if(!isEmpty)
                {
                    $('.hidden-id').val(null)
                    $('.submit').text('Ajouter')
                }
            })
        })
    </script>
{% endblock %}
