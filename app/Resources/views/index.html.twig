{% extends 'base.html.twig' %}

{% block content %}
    <main>

        {# ----------------- message d'erreur et loading AJAX ----------------- #}
        <div id="flash-ajax" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <p></p>
        </div>
        <div id="loading-modal" class="d-none" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
            <i class="fas fa-spinner fa-3x"></i>
            {#<p>veuillez patienter</p>#}
        </div>

        {#<h1 class="title-page">Les Associables</h1>#}

        <div class="welcome">
            <img src="{{ asset('assets/images/logo.png') }}" class="main-logo" alt="logo les associables.org">
            <p class="header">
                Donnez en quelques cliques aux associations de votre choix
                et déduisez vos dons de votre impôt sur le revenu.
            </p>
            <div class="calc">
                <label for="donation">Je donne</label>
                <select name="donation" id="donation" class="donation custom-select">
                    {% for amount in array_amount %}
                        <option
                                {% if amount == default_amount %}
                                    {# détecte le montant selectionné par défaut #}
                                    selected
                                {% endif %}
                                value="{{ amount }}">{{ amount }}€</option>
                    {% endfor %}
                </select>
                <span>soit <b><i id="result"></i></b> après réduction d'impôts</span>
            </div>
            <p>
                Vous pouvez déduire 75 % de votre don à hauteur de 546 € par an. <br>
                Au delà, votre don est déductible à hauteur de 66 % dans la limite de 20 % de votre revenu net imposable.
            </p>
        </div>

        <div class="container">
            <h5 class="title-page mt-5 mb-4">Les associations qui ont reçu des dons récemment</h5>

            <div class="home-assos">
                {% for association in associations %}
                    <div class="asso mb-3">
                        <a href="{{ path('association_id', {id: association.id}) }}" class="link-asso">
                            {# ----------------- Images des associations ----------------- #}
                            <div class="image-asso d-flex align-items-center">
                                {% if association.image is null %}
                                    <img src="{{ asset(ImgAssosDefault) }}" alt="image par défaut">
                                {% else %}
                                    <img src="{{ asset(ImgAssosFolder ~ association.image) }}" alt="{{ association.name }}">
                                {% endif %}
                            </div>
                            <h4>{{ association.name }}</h4>
                        </a>

                        <p class="descript">{{ association.description |length > 50 ? association.description |slice(0, 50) ~ '...' : association.description  }}</p>

                        {# ----------------- Catégories des associations ----------------- #}
                        <p class="catg">
                            {% for category in association.categories %}
                                {{ category.name }}
                                {% if loop.index < association.categories | length %}
                                    {# détecte la dernière catégories #} <b>/</b>
                                {% endif %}
                            {% endfor %}
                        </p>

                        {# ----------------- Dons aux associations ----------------- #}
                        <div class="form-don">
                            <select name="donation" id="don" class="donation custom-select mr-2">
                                {% for amount in array_amount %}
                                    <option
                                        {% if amount == default_amount %}
                                            {# détecte le montant selectionné par défaut #}
                                            selected
                                        {% endif %}
                                        value="{{ amount }}">{{ amount }}€</option>
                                {% endfor %}
                            </select>
                            <button class="donation-button btn btn-info btn-sm" data-association-id="{{ association.id }}">Donner</button>
                        </div>
                    </div>
                {% endfor %}
                <a href="{{ path('associations') }}" class="btn btn-info mt-3">Toutes les Assos</a>
            </div>

            <h5 class="title-page mt-5 mb-3">Les avis utilisateurs récents</h5>

            <div class="home-reviews">
                {% for review in reviews %}
                    <div class="review-asso">
                        <a href="{{ path('association_id', {id: review.assos.id}) }}" class="link-asso">{{ review.assos.name }}</a>
                        <p>{{ review.comment }}</p>
                        <span>
                            {% for i in range(1, 5) %}
                                {% if review.mark >= i %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </span>
                        <p class="sign">{{ review.user }}, le : {{ review.createdAt | date('d-m-y') }} à {{ review.createdAt | date('H:i:s') }}</p>
                    </div>
                {% endfor %}
            </div>
            <a href="{{ path('fos_user_registration_register') }}" class="btn btn-info mt-3 mb-5">S'inscrire</a>
        </div>

    </main>
{% endblock %}

{% block scripts %}
    {% include 'includes/js_ajax_basket.html.twig' %}

    <script>

        calc()

        $(document).ready(function () {

            $('#donation').change(function () {
                calc()
            })
        })

        function calc() {
            var don = $('#donation').val()
            var result = don - (don * 75 / 100)

            $('#result').text(result + '€')
        }
    </script>
{% endblock %}