
{#  Script de rajout des dons au paniers depuis l'onglet 'Associations'  #}

<script>
    {# On attend que la page est fini de charger #}
    $(document).ready(function() {

        {# affiche la modal loading-modal pendant le chargement AJAX #}
        $(document).ajaxStart(function(){
            $('#loading-modal').removeClass('d-none')
        })

        {# Récupère data-basket-quantity pour afficher ou cacher la bulle Panier (basket-tick) #}
        if($('.basket-tick').data('basket-quantity') > 0)
        {
            $('.basket-tick').removeClass('d-none')
        } else {
            $('.basket-tick').addClass('d-none')
        }

        {# On écoute l'évènement 'click' sur le bouton donation #}
        $('.donation-button').on('click', function (e) {
            e.preventDefault()

            {# On recupère l'id de l'association passé en paramètre data-attribute #}
            var id = $(this).data('association-id')

            {# On recherche le montant selectionné dans la div parente au 'button' #}
            {# Soit this(button) -> parent(div) -> option selectionné et récupère sa valeur #}
            var amount = $(this).parent().find('option:selected').val()

            {# fontion AJAX méthode POST #}
            $.ajax({
                type: "POST",
                {# chemin vers la route controller qui va traiter les datas #}
                url: '{{ path('_ajax_add_to_basket') }}',
                {# Data a envoyer en POST #}
                data: {
                    id: id,
                    amount: amount
                },
                {# fontion à excécuter en cas de success #}
                success: function (response)
                {
                    if(response.status === true)
                    {
                        {# raffraichi le nombre de dons en cas de succès #}
                        if(response.quantity > 0)
                        {
                            $('.basket-tick').removeClass('d-none')
                            $('.basket-tick').text(response.quantity)

                        } else {

                            $('.basket-tick').addClass('d-none')
                        }
                        $('#flash-ajax p').text('')
                    }
                    else if(response.status === false)
                    {
                        {# affiche un message d'erreur en cas d'échec #}
                        $('#flash-ajax p').text('une erreur est survenue, veuillez réessayer.')
                    }
                },
                {# Type de réponse attendu #}
                dataType: 'json'
            });
        })

        {# cache la modal loading-modal après le chargement AJAX #}
        $(document).ajaxStop(function(){
            $('#loading-modal').addClass('d-none')
        })
    })
</script>
